<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Abstraction Layer Architecture | TouchGFX Documentation</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="TouchGFX Documentation"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="import Figure from &#x27;@site/components/Figure&#x27;;"><meta data-react-helmet="true" property="og:description" content="import Figure from &#x27;@site/components/Figure&#x27;;"><meta data-react-helmet="true" property="og:url" content="https://touchgfx.github.io/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentArchitecture">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png">


<link rel="stylesheet" href="/styles.cdb1878b.css">


<link rel="preload" href="/styles.1c1f777e.js" as="script">

<link rel="preload" href="/runtime~main.4b0053e0.js" as="script">

<link rel="preload" href="/main.8613d32b.js" as="script">

<link rel="preload" href="/common.48678e5d.js" as="script">

<link rel="preload" href="/2.68cf1920.js" as="script">

<link rel="preload" href="/3.3b5ba605.js" as="script">

<link rel="preload" href="/1be78505.321ed9b6.js" as="script">

<link rel="preload" href="/20ac7829.e3e211d1.js" as="script">

<link rel="preload" href="/17896441.f3687c19.js" as="script">

<link rel="preload" href="/612c7daa.ec0206c1.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="My Site Logo"></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/Introduction/Welcome">Docs</a><a class="navbar__item navbar__link" target="_blank" href="/api/">API</a><a class="navbar__item navbar__link" activeclassname="navbar__link--active" to="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx">Community</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.png" alt="My Site Logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction/Welcome">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" href="/api/">API</a></li><li class="menu__list-item"><a class="menu__link" activeclassname="navbar__link--active" to="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx">Community</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/logo.png" alt="My Site Logo"></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction/Welcome">Welcome</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction/WhatIsTouchGFX">What is TouchGFX?</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction/Installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction/GettingStarted">Getting Started</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basic Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/BasicConcepts/EmbeddedGraphics">Embedded Graphics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/BasicConcepts/Framebuffer">Framebuffer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/BasicConcepts/GraphicsEngine">Graphics Engine</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/BasicConcepts/Rendering">Main Loop</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/BasicConcepts/Performance">Performance</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/DevelopmentIntroduction">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Hardware Selection</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareSelectionIntroduction">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Hardware Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareComponents/HardwareSelectionMCU">MCU</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareComponents/HardwareSelectionDisplay">Display</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareComponents/HardwareSelectionExternalFlash">External Flash</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareComponents/HardwareSelectionExternalRAM">External RAM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareComponents/HardwareSelectionBus">Bus</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/FindingTheRightHardware">Finding the Right Hardware</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/HardwareSelection/HardwareSelectionScenarios">Scenarios</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Board Bring Up</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/BoardBringUp/BoardIntroduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/BoardBringUp/BoardDisplay">Display</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/BoardBringUp/BoardExGPIO">External events as triggers</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">TouchGFX HAL Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentIntroduction">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentArchitecture">Abstraction Layer Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentGenerator">Generator User Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Scenarios</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/scenarios/TouchGFXHALDevelopmentScenariosIntro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentScenarios">LTDC/Parallel RGB</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/scenarios/TouchGFXHALDevelopmentScenariosFMC">FMC / Intel 8080</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/scenarios/TouchGFXHALDevelopmentScenariosDSI">LTDC+DSI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/TouchGFXHALDevelopment/scenarios/TouchGFXHALDevelopmentScenariosSPI">SPI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/BoardBringUp/BoardExGPIO">External events as triggers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">UI Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIDevelopmentIntroduction">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Software Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/software-architecture/model-view-presenter-design-pattern">Model-View-Presenter Design Pattern</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/software-architecture/screen-definition-and-mvp">The Screen Concept</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/software-architecture/code-structure">Code Structure</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Working with TouchGFX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/WorkingWithTouchGFX/using-ides-with-touchgfx">Using IDEs with TouchGFX</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/WorkingWithTouchGFX/widgets-and-containers">Widgets and Containers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/WorkingWithTouchGFX/simulator">Simulator</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/WorkingWithTouchGFX/Debugging">Debugging</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Designer User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/StartupWindow">Startup Window</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/FileMenu">File Menu</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/MainWindow">Main Window</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/CanvasView">Canvas View</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/ImagesView">Images View</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/TextsView">Texts View</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/ConfigView">Config View</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/DesignerUserGuide/Interactions">Interactions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">TouchGFX Engine Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/CustomTriggersAndActions">Custom Triggers and Actions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/custom-containers">Custom Containers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/CanvasWidgets">Canvas Widgets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/CachingBitmaps">Caching Bitmaps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/CustomWidgets">Custom Widgets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/CanvasWidgets">Canvas Widgets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/DynamicBitmaps">Dynamic Bitmaps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/using-binary-fonts">Binary Fonts</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/FontCache">Font Caching</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/backend-communication">Backend Communication</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/mixins">Mixins</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/TouchGFXEngineFeatures/TextsAndFonts">Texts and Fonts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">UI Components</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Buttons</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/Button">Button</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/ButtonWithLabel">ButtonWithLabel</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/ButtonWithIcon">ButtonWithIcon</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/ToggleButton">ToggleButton</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/RadioButton">RadioButton</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/RepeatButton">RepeatButton</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Buttons/FlexButton">FlexButton</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Images</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Images/Image">Image</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Images/ScalableImage">ScalableImage</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Images/TiledImage">TiledImage</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Images/AnimatedImage">AnimatedImage</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Images/TextureMapper">TextureMapper</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Containers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/Container">Container</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/ScrollableContainer">ScrollableContainer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/SwipeContainer">SwipeContainer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/ListLayout">ListLayout</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/ModalWindow">ModalWindow</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/ScrollList">ScrollList</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Containers/ScrollWheel">ScrollWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ProgressIndicators</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/ProgressIndicators/BoxProgress">BoxProgress</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/ProgressIndicators/ImageProgress">ImageProgress</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/ProgressIndicators/TextProgress">TextProgress</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/ProgressIndicators/LineProgress">LineProgress</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/ProgressIndicators/CircleProgress">CircleProgress</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Shapes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Shapes/Box">Box</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Shapes/BoxWithBorder">BoxWithBorder</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Shapes/Line">Line</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Shapes/Circle">Circle</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Shapes/Shape">Shape</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Miscellaneous</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Miscellaneous/Slider">Slider</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Miscellaneous/TextArea">TextArea</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Miscellaneous/AnalogClock">AnalogClock</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/Miscellaneous/DigitalClock">DigitalClock</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/UIComponents/GeneralUIComponentPerformance">General UI Component Performance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Scenarios</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/AchievingBetterPerformanceWithCacheableContainer">Achieving Better Performance with CacheableContainer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/LoadingImagesAtRuntime">Loading Images at Runtime</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/LoweringMemoryUsageWithPartialFrameBuffer">Lowering Memory Usage with Partial Framebuffer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/UsingTheL8ImageFormatToReduceMemoryConsumption">Using the L8 Image Format to Reduce Memory Consumption</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/CreatingDynamicL8Images">Creating Dynamic L8 Images</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Development/UIDevelopment/Scenarios/UsingNonMemoryMappedFlash">Using Non-Memory Mapped Flash for storing images</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Miscellaneous</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/miscellaneous/known-issues">Known Issues</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/miscellaneous/changelog">Changelog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/miscellaneous/3rd-party-components-in-touchgfx">3rd Party Components in TouchGFX</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/miscellaneous/supported-stm32-evaluation-kits">Supported STM32 Evaluation Kits</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Tutorials/tutorial-01">Tutorial 1: Trying Out the Examples</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Tutorials/tutorial-02">Tutorial 2: Creating Your Own Application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Tutorials/tutorial-03">Tutorial 3: Applications with Multiple Screens</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Tutorials/tutorial-04">Tutorial 4: Creating a Scroll Wheel with Custom Behavior</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/Tutorials/tutorial-05">Tutorial 5: Creating Custom Triggers and Actions</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Abstraction Layer Architecture</h1></header><div class="markdown"><div class="figure noshadow"><a href="/img/Development/TouchGFXHALDevelopment/activities_selected_002.png" target="_blank"><img src="/img/Development/TouchGFXHALDevelopment/activities_selected_002.png"></a><p>Project activity</p></div><p>The TouchGFX engine relies on a software layer that abstract memories,
external events and syncronization of framebuffer access. This layer
is implemented by the HAL developer and typically makes use of both
hardware (HAL) and software (OSAL) elements.<br>
The software abstraction mainly links the engine to the specific
operating system used.</p><p>As we saw in the previous section, the TouchGFX engine uses the events
listed in table below. These are either sent from the engine or
expected by the engine. In the rest of this section we will discuss
these events in detail.</p><table><thead><tr><th>Event</th><th>Abstraction (OS or Hardware)</th></tr></thead><tbody><tr><td><a href="#block-engine-main-loop">Block Engine Main Loop</a></td><td>Operating system</td></tr><tr><td><a href="#unblock-the-engine-main-loop">Unblock engine Main Loop</a></td><td>Operating system and hardware</td></tr><tr><td><a href="#initiate-framebuffer-transfer-to-display">Initiate framebuffer transfer to display</a></td><td>Hardware</td></tr><tr><td><a href="#read-external-events">Read external events</a></td><td>Hardware</td></tr><tr><td><a href="#get-next-framebuffer-memory">Get next framebuffer memory address</a></td><td>Hardware</td></tr><tr><td><a href="#perform-hardware-assisted-render-operations">Perform hardware assisted render operations</a></td><td>Hardware</td></tr><tr><td><a href="#synchronize-the-framebuffer">Synchronize the framebuffer (OSAL)</a></td><td>Operating system and hardware</td></tr></tbody></table><p>Each following subsection highlights the effort required to fulfill
each of the above. Many of the elements can be copied from existing
TouchGFX Projects or these can be used as reference
implementations. For custom hardware platforms the TouchGFX Generator,
inside STM32CubeMX, can generate most of the HAL and TouchGFX
project. The remaining parts, that the HAL developer must implement
manually, is pointed out through code comments and warnings. <a href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentGenerator">Read
more</a>
about the TouchGFX Generator in the next section. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="oswrappers-and-hal-classes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#oswrappers-and-hal-classes" title="Direct link to heading">#</a>OSWrappers and HAL classes</h3><p>The hardware abstractions are accessed by the TouchGFX Engine through
the HAL subclass.</p><p>The operating system abstractions are accessed through a class called
OSWrappers. This class is mainly used to syncronize events in the
render cycle as well as framebuffer memory access. The OSWrapper class
must be implemented by the user.</p><div class="figure noshadow"><a href="/img/Development/TouchGFXHALDevelopment/architecture/hal_and_oswrappers.png" target="_blank"><img src="/img/Development/TouchGFXHALDevelopment/architecture/hal_and_oswrappers.png"></a><p>Project activity</p></div><p>TouchGFX Generator can provide complete <code>OSWrappers</code> implementation
for CMSIS OS V1, CMSIS OS V2 and &quot;No operating system&quot;.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="block-the-engine-main-loop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#block-the-engine-main-loop" title="Direct link to heading">#</a>Block the Engine Main Loop</h2><p>The first thing the <em>TouchGFX Engine</em> does after rendering each frame
(and also before starting its main loop) is to call
<code>OSWrappers::waitForVsync</code>.</p><p>This method must block the graphics engine until it is time to render
the next frame. The standard method to implement this block is peform
a blocking read from message queue. Another method is to loop in a
spinlock. The HAL developer is free to use any method to implement the
block if neither of these methods are feasible.</p><p>When the block is released (and the function returns) TouchGFX will
start rendering the next application frame.</p><p>The following code causes the TouchGFX engine to block until an element is added to the queue by
another part of the system.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> osMessageQId vsync_queue </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Queue identifier is assigned elsewhere</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> OSWrappers</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">waitForVSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Wait for next VSYNC to occur, by reading from the queue</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">osMessageGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vsync_queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> osWaitForever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>If not using an RTOS, the TouchGFX Generator provides the following
implementation for <code>waitForVSync</code> using a volatile variable.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">volatile</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> vsync_sem </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> OSWrappers</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">waitForVSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">vsync_sem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Perform other work while waiting</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content"><li><b><i>While</i></b> TouchGFX Engine is waiting to produce the next frame other tasks can do important work.</li><li><b><i>When</i></b> TouchGFX Engine is allowed to proceed time passes in the application; It is &quot;ticked&quot;.</li></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="unblock-the-engine-main-loop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#unblock-the-engine-main-loop" title="Direct link to heading">#</a>Unblock the Engine Main Loop</h2><p>The signal to unblock the Engine Main Loop should come from an
interrupt from a display controller, from the display itself or even
from a hardware timer. The source of the signal is dependant on the
type of display.</p><p>The <code>OSWrappers</code> class defines a function for this signal:
<code>OSWrappers::signalVsync</code>. The implementation of the function must
unblock the Engine Main Loop by satisfying the wait condition used in
<code>OSWrappers::waitForVSync</code>.</p><p>Continuing with the above CMSIS RTOS example, we put a message into
the message queue. This will unblock the graphics engine.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> OSWrappers</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">signalVSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vsync_queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">osMessagePut</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vsync_queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>This <code>OSWrappers::signalVSync</code> method must be hardware
level. Typically this is from an interrupt handler for the LTDC
controller, the external signal from the display, or a timer.</p><p>If not using an RTOS, the implementation is also simple. Just assign a
non-zero value to break the while-loop:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> OSWrappers</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">signalVSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    vsync_sem </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="initiate-framebuffer-transfer-to-display"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#initiate-framebuffer-transfer-to-display" title="Direct link to heading">#</a>Initiate framebuffer transfer to display</h2><p>TouchGFX Engine always signals the abstraction layer once rendering of
an area has been completed. The engine calls this virtual function:
<code>HAL::flushFrameBuffer(Rect&amp; rect)</code>.</p><p>On STM32 microcontrollers with LTDC controllers we don&#x27;t need to do
anything to transmit the framebuffer after every rendering. This
happens continuously with a given frequency after the LTDC has been
initialized.</p><p>For other display types like SPI or 8080 you need to transfer the
framebuffer manually.</p><p>The implementation of this function allows developers to initiate a
manual transfer of that area of the framebuffer to a display with
GRAM:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> TouchGFXHAL</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">flushFrameBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> touchgfx</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">Rect</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HAL</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">flushFrameBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//call superclass</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//start transfer if not running already!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">LCDManager_IsTransmittingData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> pixels </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calculate pixel address</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">LCDManager_SendFrameBufferRect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">pixels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">width</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">height</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Queue rect for later or wait here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content">For MCUs with TFT controllers TouchGFX Generator can generate a handler that unblocks the TouchGFX Engine (2) and initiates a framebuffer transfer (3). For MCUs without TFT controllers, `HAL::flushFrameBuffer(Rect&amp; rect)` can be used to transfer the framebuffer memory.</div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="read-external-events"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#read-external-events" title="Direct link to heading">#</a>Read External Events</h2><p>Before rendering a new frame, the graphics engine read external events
from the Touch Controller and from physical buttons.</p><p>Other external peripherals or values read from GPIOs can be mapped to
specific values internally in the application to be used in user
specified interactions, e.g. to change screens when the user presses
JOYSTICK LEFT.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="touch-coordinates"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#touch-coordinates" title="Direct link to heading">#</a>Touch Coordinates</h3><p>Coordinates from the touch controller are translated into click-,
drag- and gesture events in the application.  The application passes
an object of a subclass of the TouchController class to the
abstraction layer. This code can be generated by the TouchGFX Generator:</p><div class="code-header"><div><h5>TouchGFXConfiguration.cpp</h5></div></div><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> STM32TouchController tc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> STM32L4DMA dma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> LCD24bpp display</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> ApplicationFontProvider fontProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> Texts texts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> TouchGFXHAL </span><span class="token function" style="color:rgb(130, 170, 255)">hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> display</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">390</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">390</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><p>During the TouchGFX Engine render cycle, when collecting input, the enging
calls the <code>sampleTouch()</code> function on the <em>tc</em> object:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> STM32TouchController</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">sampleTouch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int32_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int32_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></code></pre></div><p>The implementation, provided by the HAL developer, should assign the
read touch coordinate values to x and y and return whether or not a
touch was detected (true or false).</p><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content">The TouchGFX Generator will generate a class that defines the TouchController interface functions as empty. The HAL developer must fill in the implementation.</div></div><p>There are multiple ways of implementing this function: </p><ol><li><em>Polling in sampleTouch()</em><br>Read touch status from the hardware touch controller (typically I2C)
by sending a request and polling for the result. This impacts the
overall render time of the application as the i2C round-trip is often
up to 1ms during which the graphics enging is blocked.</li><li><em>Interrupt based</em><br>Another possibility is to use interrupts. The read to the I2C
controller is started regularly by a timer or as a response to an
external interrupt from the touch hardware. When the I2C data is
available (another interrupt) the data is made available to the
STM32TouchController. E.g. through a message queue or global
variables. Below is the code generated by the TouchGFX Generator:</li></ol><div class="code-header"><div><h5>TouchGFXConfiguration.cpp</h5></div></div><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> STM32TouchController</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">sampleTouch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int32_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int32_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">osMessageQueueGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mid_MsgQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> osOK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="other-external-events"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#other-external-events" title="Direct link to heading">#</a>Other External Events</h3><p>The Button Controller interface, <code>touchgfx::ButtonController</code>, can be
used to map hardware signals (buttons or other) to events to the the
application. The reaction to these events can be configured within
TouchGFX Designer.</p><p>The use of this interface is similar to the TouchController above,
except that it is not mandatory to have a ButtonController. To use it,
create an instance of a class implementing the ButtonController
interface, and pass the instance to HAL:</p><div class="code-header"><div><h5>TouchGFXConfiguration.cpp</h5></div></div><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-cpp codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyButtonController</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> touchgfx</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">ButtonController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Sample IO, set key, return true/false</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> MyButtonController bc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">touchgfx_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setButtonController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">bc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>The <em>sample</em> method in your ButtonController class is called before
each frame. If you return true, the key value will be passed to the
<em>handleKeyEvent</em> eventhandler of the current Screen.</p><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content">See &quot;Board bringup&quot; for how to configure GPIOs / buttons in CubeMX.</div></div><div class="highlight highlight-try"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Things to try</h5></div><div class="highlight-content">Use the value assigned to the `key` reference as the trigger for an interaction in TouchGFX Designer.</div></div><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">See the <a to="docs/Development/UIDevelopment/DesignerUserGuide/Interactions" href="docs/Development/UIDevelopment/DesignerUserGuide/Interactions">Interactions </a> article for further information on how to use values sampled through the ButtonController as triggers for interactions in the designer.  </div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="get-available-framebuffer-area"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-available-framebuffer-area" title="Direct link to heading">#</a>Get Available Framebuffer Area</h2><p>Regardless of rendering strategy TouchGFX Engine must know, in each
tick, which memory area it should render pixels to. Using single- or
double framebuffer strategies the TouchGFX Engine will write pixel
data to a memory area according to the full width, height, and bit
depth, of the framebuffer. The graphics engine takes care of swapping
between the two buffers in a double buffer setup.</p><p>It is possible to limit the access to the framebuffer to part of the
framebuffer. The method <em>HAL::getTFTCurrentLine()</em> can be
reimplemented in your HAL subclass. Return the line number above which
it is save for the graphics engine to draw.</p><p>Using a Partial Framebuffer strategy the developer defines one or more
blocks of memory that TouchGFX Engine will use when rendering. Read
more about that
<a href="/docs/Development/UIDevelopment/Scenarios/LoweringMemoryUsageWithPartialFrameBuffer">here</a>.</p><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content">TouchGFX Generator can provide configurations for all supported framebuffer strategies.</div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="perform-hardware-assisted-render-operations"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#perform-hardware-assisted-render-operations" title="Direct link to heading">#</a>Perform Hardware Assisted Render Operations</h2><p>Rendering and displaying graphics are rarely the sole purposes of an
application. Other tasks also need to use the cpu. One goal of
TouchGFX is to draw the user interface using as few cpu cycles as
possible. The HAL class abstracts the DMA2D found on many STM32
microcontrollers (or other hardware capabilities) and makes this
available to the graphics engine.</p><p>When rendering assets such as bitmaps to the framebuffer, the TouchGFX
Engine checks if the HAL has the capability to &#x27;blit&#x27; a portion of- or
all of the bitmap into to the framebuffer. If so, the drawing
operation is delegated to the HAL rather than being handled by the
CPU.</p><p>The engine calls the method <em>HAL::getBlitCaps()</em> to get a description
of the capabilities of the hardware. You HAL subclass can reimplement
this to add the capabilities.</p><p>When the engine is drawing the user interface it will call operations
on the HAL class, e.g. <code>HAL::blitCopy</code>, that queue the operations for
the DMA. If the HAL does not report the required capability, the
graphics engine will use a software rendering fallback.</p><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content"> A lot of STM32 MCUs have a ChromART chip which can move data from e.g. external Flash memory into the framebuffer while alpha blending all the pixels.<p>For many MCUs, TouchGFX Generator can generate a driver which adds the
capability of several &#x27;blit&#x27; operations using the ChromART chip.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="synchronize-the-framebuffer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#synchronize-the-framebuffer" title="Direct link to heading">#</a>Synchronize the framebuffer</h2><p>Multiple actors may be interested in accessing the framebuffer memory.</p><p>These are typically:</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>1</td><td>CPU</td><td>Reads and writes pixels during drawing</td></tr><tr><td>2</td><td>DMA2D</td><td>Reads and writes pixels during hardware assisted drawing</td></tr><tr><td>3</td><td>LTDC</td><td>Reads pixels during transfer to display</td></tr></tbody></table><p>If you are using a SPI display or similar, another DMA may be reading
pixels for transfer (replacing the LTDC).</p><p>The TouchGFX Engine synchronizes framebuffer access through the
<code>OSWrappers</code> interface and peripherals that also wish to access the
framebuffer must do the same.</p><p>The normal design is to use a semaphore to guard the access to the
framebuffer, but other synchronization mechanisms can be used.</p><p>These methods are used:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>takeFrameBufferSemaphore</td><td>Called by graphics engine to get exclusive access to the framebuffer. This will block the engine until the DMA2D is done (if running)</td></tr><tr><td>tryTakeFrameBufferSemaphore</td><td>Ensure that the lock is taken. This method does not block, but ensures that the next call to takeFrameBufferSemaphore will block its caller</td></tr><tr><td>giveFrameBufferSemaphore</td><td>Releases the framebuffer lock</td></tr><tr><td>giveFrameBufferSemaphoreFromISR</td><td>Releases the framebuffer lock from an interrupt context</td></tr></tbody></table><p>The HAL developer must make sure all these methods are implemented in
the OSWrappers.cpp file.</p><div class="highlight highlight-tip"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Tip</h5></div><div class="highlight-content">The TouchGFX Generator can generate a ChromART driver that synchronizes using the OSWrappers interface as well as implementations for functions that perform this synchronization depending on choice of RTOS.</div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentIntroduction"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Introduction</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Development/TouchGFXHALDevelopment/TouchGFXHALDevelopmentGenerator"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Generator User Guide »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#oswrappers-and-hal-classes" class="contents__link">OSWrappers and HAL classes</a></li><li><a href="#block-the-engine-main-loop" class="contents__link">Block the Engine Main Loop</a></li><li><a href="#unblock-the-engine-main-loop" class="contents__link">Unblock the Engine Main Loop</a></li><li><a href="#initiate-framebuffer-transfer-to-display" class="contents__link">Initiate framebuffer transfer to display</a></li><li><a href="#read-external-events" class="contents__link">Read External Events</a><ul><li><a href="#touch-coordinates" class="contents__link">Touch Coordinates</a></li><li><a href="#other-external-events" class="contents__link">Other External Events</a></li></ul></li><li><a href="#get-available-framebuffer-area" class="contents__link">Get Available Framebuffer Area</a></li><li><a href="#perform-hardware-assisted-render-operations" class="contents__link">Perform Hardware Assisted Render Operations</a></li><li><a href="#synchronize-the-framebuffer" class="contents__link">Synchronize the framebuffer</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 ST Microelectronics</div></div></div></footer>
</div>

<script src="/styles.1c1f777e.js"></script>

<script src="/runtime~main.4b0053e0.js"></script>

<script src="/main.8613d32b.js"></script>

<script src="/common.48678e5d.js"></script>

<script src="/2.68cf1920.js"></script>

<script src="/3.3b5ba605.js"></script>

<script src="/1be78505.321ed9b6.js"></script>

<script src="/20ac7829.e3e211d1.js"></script>

<script src="/17896441.f3687c19.js"></script>

<script src="/612c7daa.ec0206c1.js"></script>


</body>
</html>