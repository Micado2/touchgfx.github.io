(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{264:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return p})),a.d(t,"rightToc",(function(){return r})),a.d(t,"default",(function(){return l}));var i=a(1),n=a(9),c=(a(0),a(273)),m=(a(274),a(289),a(286),a(288),a(283),a(287),a(276),a(282)),o={id:"dynamic-bitmaps",title:"Dynamic Bitmaps"},p={id:"development/ui-development/touchgfx-engine-features/dynamic-bitmaps",title:"Dynamic Bitmaps",description:"import Figure from '@site/components/Figure';",source:"@site/docs\\development\\ui-development\\touchgfx-engine-features\\dynamic-bitmaps.mdx",permalink:"/docs/development/ui-development/touchgfx-engine-features/dynamic-bitmaps",sidebar:"docs",previous:{title:"Canvas Widgets",permalink:"/docs/development/ui-development/touchgfx-engine-features/canvas-widgets"},next:{title:"Binary Fonts",permalink:"/docs/development/ui-development/touchgfx-engine-features/using-binary-fonts"}},r=[{value:"Dynamic Bitmap Configuration",id:"dynamic-bitmap-configuration",children:[]},{value:"Using a Dynamic Bitmap Example",id:"using-a-dynamic-bitmap-example",children:[]},{value:"Dynamic Bitmap Operations",id:"dynamic-bitmap-operations",children:[{value:"Creating a Dynamic Bitmap",id:"creating-a-dynamic-bitmap",children:[]},{value:"Creating a Dynamic Bitmap",id:"creating-a-dynamic-bitmap-1",children:[]},{value:"Get the address of the pixels in a Dynamic Bitmap",id:"get-the-address-of-the-pixels-in-a-dynamic-bitmap",children:[]},{value:"Set the solid area of a Dynamic Bitmap",id:"set-the-solid-area-of-a-dynamic-bitmap",children:[]}]}],s={rightToc:r},d="wrapper";function l(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(c.b)(d,Object(i.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"This section explains how to use Dynamic Bitmaps. Recall that standard\nbitmaps are compiled into the application and therefore must be\navailable at compile time. The bitmaps are converted from e.g. PNG\nfiles and stored in an internal format together with size and format\ninformation."),Object(c.b)("p",null,"It is also possible to create a bitmap in RAM at runtime. This is\ncalled a ",Object(c.b)("em",{parentName:"p"},"dynamic bitmap"),". A dynamic bitmap can be used just as the\nstatic bitmaps that are compiled into the application. This means that\nyou can use a dynamic bitmap with e.g. the Image and Button widgets."),Object(c.b)("h2",{id:"dynamic-bitmap-configuration"},"Dynamic Bitmap Configuration"),Object(c.b)("p",null,"When you create a dynamic bitmap the RAM for the pixels is allocated from\nthe bitmap cache. You must therefore configure a bitmap cache before\nyou can create dynamic bitmaps."),Object(c.b)("p",null,"See the article on ",Object(c.b)("a",Object(i.a)({parentName:"p"},{href:"/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps"}),"bitmap caching"),"\nfor configuration instructions."),Object(c.b)("p",null,"It is required to define the maximum number of Dynamic Bitmaps used in\nyour application. This maximum is passed to TouchGFX together with the\nbitmap cache address and size. Here we configure a bitmap cache with\nup to 4 dynamic bitmaps:"),Object(c.b)(m.a,{mdxType:"CodeHeader"},"BoardConfiguration.cpp (extract)"),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp",metastring:"{4-4}","{4-4}":!0}),"// Place cache start address in SDRAM at address 0xC0008000;\nuint16_t* cacheStartAddr = (uint16_t*)0xC0008000;\nuint32_t cacheSize = 0x300000; //3 MB, as example\nHAL& hal = touchgfx_generic_init<STM32F4HAL>(dma, display, tc, DISPLAY_WIDTH, DISPLAY_HEIGHT, cacheStartAddr, cacheSize, 4);\n")),Object(c.b)("h2",{id:"using-a-dynamic-bitmap-example"},"Using a Dynamic Bitmap Example"),Object(c.b)("p",null,"To use the dynamic bitmap we need a widget to show it. So insert an\nImage widget in the view (in code or in the Designer):"),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp",metastring:"{4-4}","{4-4}":!0}),"class TemplateView : public View\n{\nprivate:\n    Image image;\n}\n")),Object(c.b)("p",null,"Create the dynamic bitmap in setupScreen. Here we use the 16bpp format\nRGB565. If your framebuffer is e.g 24 bit use RGB888. To create a\ntransparent bitmap, use the format ARGB8888:"),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp",metastring:"{5-6}","{5-6}":!0}),"void TemplateView::setupScreen()\n{\n    BitmapId bmpId;\n\n    //Create (16bit) dynamic bitmap of size 100x150\n    const int width = 100;\n    const int height = 150;\n    bmpId = Bitmap::dynamicBitmapCreate(100, 150, Bitmap::RGB565);\n\n    //set all pixels white\n    if (bmpId != BITMAP_INVALID)\n    {\n       memset(Bitmap::dynamicBitmapGetAddress(bmpId), 0xFF, width*height*2);\n    }\n\n    //Make Image widget show the dynamic bitmap\n    image.setBitmap(Bitmap(bmpId));\n\n    //Position image and add to View\n    image.setXY(20, 20);\n    add(image);\n    ...\n}\n")),Object(c.b)("p",null,"If you want to load your image from a file you can replace the call to memset with your loader code. See the article ",Object(c.b)("a",Object(i.a)({parentName:"p"},{href:"/docs/development/ui-development/scenarios/loading-images-at-runtime"}),"Loading Images At Runtime")),Object(c.b)("h2",{id:"dynamic-bitmap-operations"},"Dynamic Bitmap Operations"),Object(c.b)("p",null,"The dynamic bitmap operations are all placed in the Bitmap class."),Object(c.b)("h3",{id:"creating-a-dynamic-bitmap"},"Creating a Dynamic Bitmap"),Object(c.b)("p",null,"The following method creates a dynamic bitmap with the width, height\nand bitmap format specified. The bitmap is only created if enough\nunused memory is available. The method returns BITMAP_INVALID if the\nbitmap was not created."),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp"}),"static BitmapId Bitmap::dynamicBitmapCreate(const uint16_t width, const uint16_t height, BitmapFormat format)\n")),Object(c.b)("h3",{id:"creating-a-dynamic-bitmap-1"},"Creating a Dynamic Bitmap"),Object(c.b)("p",null,"This method deletes a dynamic bitmap."),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp"}),"static bool Bitmap::dynamicBitmapDelete(BitmapId id)\n")),Object(c.b)("h3",{id:"get-the-address-of-the-pixels-in-a-dynamic-bitmap"},"Get the address of the pixels in a Dynamic Bitmap"),Object(c.b)("p",null,"The following method returns the address of the dynamic bitmap. This\nmethod is used by file loaders to copy image data into the bitmap."),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp"}),"static uint8_t* dynamicBitmapGetAddress(BitmapId id)\n")),Object(c.b)("h3",{id:"set-the-solid-area-of-a-dynamic-bitmap"},"Set the solid area of a Dynamic Bitmap"),Object(c.b)("p",null,"The following method sets the solid rectangle of a dynamic bitmap."),Object(c.b)("pre",null,Object(c.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cpp"}),"static bool dynamicBitmapSetSolidRect(BitmapId id, const Rect& solidRect)\n")),Object(c.b)("p",null,'Read more about the "solid area" concept in the ',Object(c.b)("a",Object(i.a)({parentName:"p"},{href:"/docs/development/ui-development/touchgfx-engine-features/custom-widgets#solid-area"}),"Custom Widgets"),"\narticle."),Object(c.b)("p",null,"By default the solid area is set to be the whole bitmap for\nnon-transparent formats like RGB565 and RGB8888.\nIt is set to empty for transparent formats like ARGB8888."))}l.isMDXComponent=!0},288:function(e,t,a){"use strict";var i=a(5),n=a(0),c=a.n(n),m=a(277),o=c.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},c.a.createElement("path",{"fill-rule":"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})),p=function(e){function t(){return e.apply(this,arguments)||this}return Object(i.a)(t,e),t.prototype.render=function(){return c.a.createElement(m.a,{color:"var(--highlight-color-try)",header:"Things to try",type:"try",icon:o},this.props.children)},t}(n.Component);t.a=p},289:function(e,t,a){"use strict";var i=a(5),n=a(0),c=a.n(n),m=a(277),o=c.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},c.a.createElement("path",{"fill-rule":"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})),p=function(e){function t(){return e.apply(this,arguments)||this}return Object(i.a)(t,e),t.prototype.render=function(){return c.a.createElement(m.a,{color:"var(--highlight-color-caution)",header:"Caution",type:"caution",icon:o},this.props.children)},t}(n.Component);t.a=p}}]);