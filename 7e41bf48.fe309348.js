(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{328:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return h})),n.d(t,"default",(function(){return d}));var r=n(1),a=n(9),o=(n(0),n(508)),i=n(509),l=(n(513),n(519)),c=(n(514),{id:"11-flash-loader",title:"11. Flash Loader",sidebar_label:"11. Flash Loader"}),s={id:"development/board-bring-up/how-to/11-flash-loader",title:"11. Flash Loader",description:"import Link from '@docusaurus/Link';",source:"@site/docs\\development\\board-bring-up\\how-to\\11-flash-loader.mdx",permalink:"/docs/development/board-bring-up/how-to/11-flash-loader",sidebar_label:"11. Flash Loader",sidebar:"docs",previous:{title:"10. Physical Buttons",permalink:"/docs/development/board-bring-up/how-to/10-physical-buttons"},next:{title:"Introduction",permalink:"/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction"}},h=[{value:"Motivation",id:"motivation",children:[]},{value:"Goal",id:"goal",children:[{value:"Verification",id:"verification",children:[]}]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Do",id:"do",children:[{value:"Flash loader for STM32CubeProgrammer",id:"flash-loader-for-stm32cubeprogrammer",children:[]},{value:"Proprietary application-based solution",id:"proprietary-application-based-solution",children:[]},{value:"Testing",id:"testing",children:[]}]}],u={rightToc:h},p="wrapper";function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)(p,Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"motivation"},"Motivation"),Object(o.b)("p",null,"In this step we will discuss loading data to the external flash. The\ncompiler will compile the text, fonts, and images in your project and\nproduce a binary or hex file with these data. These data are typically\nput into the external flash. The internal flash is then reserved for\ncode."),Object(o.b)("p",null,"During development we need a way to write data to the external flash,\nbut this is not necessary during runtime where we only read from the\nflash."),Object(o.b)("p",null,"Two ways are common for writing data to the external flash:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Write a flashloader for STM32CubeProgrammer"),Object(o.b)("li",{parentName:"ul"},"Use a proprietary application-based solution")),Object(o.b)(l.a,{mdxType:"Note"},"Skip this step if external flash is not present"),Object(o.b)("h2",{id:"goal"},"Goal"),Object(o.b)("p",null,"The goal in this section is to select and develop a mechanism for loading data to\nthe external flash."),Object(o.b)("h3",{id:"verification"},"Verification"),Object(o.b)("p",null,"Here are the verification points for this section:"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"Verification Point"),Object(o.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"Rationale"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"Data can be flashed"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"External flash can be used for image storage")))),Object(o.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(o.b)("p",null,"The following are the prerequisites for this step:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Information about the flash, typically a datasheet"),Object(o.b)("li",{parentName:"ul"},"Information about the connections between the MCU and the external flash")),Object(o.b)("h2",{id:"do"},"Do"),Object(o.b)("h3",{id:"flash-loader-for-stm32cubeprogrammer"},"Flash loader for STM32CubeProgrammer"),Object(o.b)("p",null,"The ",Object(o.b)(i.a,{target:"_blank",to:"https://www.st.com/en/development-tools/stm32cubeprog.html",mdxType:"Link"},"STM32CubeProgrammer")," comes with flash loaders for the various STM32\nEvaluation kits. The flash loaders are small programs that are loaded\nto the RAM of the MCU and facilitates the programming of the flash."),Object(o.b)("p",null,"The flash loader consists of two parts:\n",Object(o.b)("em",{parentName:"p"},"Configuration of the GPIOs and flash interface that are required to communicate with the flash\n"),"The flashing algorithm that knows the sequence of commands required to write in the flash"),Object(o.b)("p",null,"These parts can often be based on an existing flash loader. If you can\nfind a flash loader for the same flash that you are using, take that\nas starting point and modify the GPIO part. If you design your\nhardware by copying the flash circuit from an evaluation kit, then you\ncan use the flash loader for that kit directly. This is the\nrecommended way."),Object(o.b)("p",null,"The flash loader projects provided with ",Object(o.b)("em",{parentName:"p"},"STM32CubeProgrammer")," are found\nin the installation folder, typically here:\n",Object(o.b)("em",{parentName:"p"},"C:\\Program Files\\STMicroelectronics\\STM32Cube\\STM32CubeProgrammer\\bin\\ExternalLoader")),Object(o.b)("p",null,"A few flash loaders are provided as source code projects for IAR Embedded Workbench, Keil, and TrueStudio."),Object(o.b)("h3",{id:"proprietary-application-based-solution"},"Proprietary application-based solution"),Object(o.b)("p",null,"Another solution is to include flash loading into the application\nitself. The idea is that you already have the flash configuration\ninside your application (to be able to load from it), and maybe you\nknow how to write a block to the flash from your previous testing. You\nthen just need a way of transferring the new flash data to your\napplication. One way is through an UART. The application receives\nthe data stream, and writes the data to the flash, block by block."),Object(o.b)("p",null,"The flash cannot be in memory mapped mode while this is running, so\nthe application must typically be put in a special mode."),Object(o.b)("p",null,"Open source solutions for the transmission of bytes can be found on\nthe internet. The Y-modem protocol for example provides 16-bit CRC on the data."),Object(o.b)("h3",{id:"testing"},"Testing"),Object(o.b)("p",null,"After the data has been written to the flash, test that it can be read\ncorrectly. Use the small test programs developed in the previous\nsections."),Object(o.b)("p",null,"It is adviced to test the whole flash thoroughly now, to find any bugs\nearly."))}d.isMDXComponent=!0},508:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return f}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),h=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},u=function(e){var t=h(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=h(n),p=r,b=u["".concat(i,".").concat(p)]||u[p]||d[p]||o;return n?a.a.createElement(b,l({ref:t},s,{components:n})):a.a.createElement(b,l({ref:t},s))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=b;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},509:function(e,t,n){"use strict";var r=n(1),a=n(0),o=n.n(a),i=n(39),l=n(510),c=n(24),s=n.n(c);t.a=function(e){var t,n=e.to,c=e.href,h=n||c,u=Object(l.a)(h),p=Object(a.useRef)(!1),d=s.a.canUseIntersectionObserver;return Object(a.useEffect)((function(){return!d&&u&&window.docusaurus.prefetch(h),function(){d&&t&&t.disconnect()}}),[h,d,u]),h&&u?o.a.createElement(i.b,Object(r.a)({},e,{onMouseEnter:function(){p.current||(window.docusaurus.preload(h),p.current=!0)},innerRef:function(e){var n,r;d&&e&&u&&(n=e,r=function(){window.docusaurus.prefetch(h)},(t=new window.IntersectionObserver((function(e){e.forEach((function(e){n===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(t.unobserve(n),t.disconnect(),r())}))}))).observe(n))},to:h})):o.a.createElement("a",Object(r.a)({},e,{href:h}))}},510:function(e,t,n){"use strict";function r(e){return!1===/^(https?:|\/\/)/.test(e)}n.d(t,"a",(function(){return r}))},512:function(e,t,n){"use strict";var r=n(5),a=n(0),o=n.n(a),i=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){var e="highlight highlight-"+this.props.type;return(o.a.createElement("div",{class:e},o.a.createElement("div",{class:"highlight-heading"},o.a.createElement("h5",null,o.a.createElement("div",{class:"highlight-icon"},this.props.icon),this.props.header)),o.a.createElement("div",{class:"highlight-content"},this.props.children)))},t}(a.Component);t.a=i},513:function(e,t,n){"use strict";var r=n(5),a=n(0),o=n.n(a),i=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){var e=this.props.noShadow||!1,t=this.props.width,n=this.props.height;return e?o.a.createElement("div",{class:"figure noshadow"},o.a.createElement("a",{href:this.props.imageSource,target:"_blank"},o.a.createElement("img",{width:t,height:n,src:this.props.imageSource})),o.a.createElement("p",null,this.props.caption)):o.a.createElement("div",{class:"figure"},o.a.createElement("a",{href:this.props.imageSource,target:"_blank"},o.a.createElement("img",{width:t,height:n,src:this.props.imageSource})),o.a.createElement("p",null,this.props.caption))},t}(a.Component);t.a=i},514:function(e,t,n){"use strict";var r=n(5),a=n(0),o=n.n(a),i=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){return o.a.createElement("div",{class:"code-header"},o.a.createElement("div",null,o.a.createElement("h5",null,this.props.children)))},t}(a.Component);t.a=i},519:function(e,t,n){"use strict";var r=n(5),a=n(0),o=n.n(a),i=n(512),l=o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},o.a.createElement("path",{"fill-rule":"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})),c=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.render=function(){return o.a.createElement(i.a,{color:"var(--highlight-color-note)",header:"Note",type:"note",icon:l},this.props.children)},t}(a.Component);t.a=c}}]);